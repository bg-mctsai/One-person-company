# 給工程：情報卡資料結構（EvidenceCard / clue→載體）

> 目的：讓線索 UI 是「情報卡」（可無圖），而不是純文字列表。  
> SSOT 文案：`../介面字串表.md`（`copy.clueCard.*` / `copy.evidence.*`）。

範例資料：`./evidence-cards.sample.json`（可直接用來渲染 UI）

---

## 1) EvidenceCard Schema（概念）

```ts
type EvidenceType = 'notification' | 'chat' | 'timeline' | 'document' | 'insight';
type EvidenceRenderMode = 'text' | 'image'; // 預設 text（不要求美術做圖）

interface EvidenceCard {
  evidenceId: string;            // 例：EV-CLUE-11-1（或 UUID）
  clueId: string;                // CLUE-01 ~ CLUE-14
  evidenceType: EvidenceType;
  renderMode: EvidenceRenderMode; // text-first：用 UI 皮膚承載摘錄文字；image 為後續升級
  occurredAt: string;            // ISO time or "YYYY/MM/DD HH:mm"
  sourceLabel: string;           // 例：會議室 / 群聊 / 交付紀錄

  // 顯示文案 key（避免硬塞文字在 data）
  titleKey: string;              // 例：copy.clueCard.CLUE-11.title
  summaryKey: string;            // 例：copy.clueCard.CLUE-11.summary
  highlightKey?: string;         // 例：copy.clueCard.CLUE-11.highlight

  // 載體 payload（依 evidenceType）
  payload:
    | {
        type: 'notification';
        appName: string;
        sender: string;
        preview: string;
      }
    | {
        type: 'chat';
        threadName: string;
        messages: { from: string; text: string; at?: string; isHighlight?: boolean }[];
      }
    | {
        type: 'timeline';
        title: string;
        items: { at: string; action: string; note?: string; isHighlight?: boolean }[];
      }
    | {
        type: 'document';
        docTitle: string;
        sections: { heading: string; lines: string[]; isHighlight?: boolean }[];
      }
    | {
        // 人際/情緒/界線類情報：不強迫用「文件/截圖」表現
        type: 'insight';
        speaker?: string; // 例：許子維 / 王明哲 / 林予衡 / 你
        insightTags: string[]; // 例：boundary, power, manipulation, shame, dutyDumping
        excerpt?: string; // 1–2 句「可核對摘錄」（可來自回合 transcript）
        rationale: string; // 為什麼這是線索（規則化解釋，不要自由抒情）
      };
}
```

---

## 2) clueId → evidenceType 對應（MVP）

> 先做「每條線索 1 張情報卡」即可；**預設 renderMode=text**。

| clueId | evidenceType |
|---|---|
| CLUE-01 | chat |
| CLUE-02 | chat |
| CLUE-03 | chat |
| CLUE-04 | notification |
| CLUE-05 | chat |
| CLUE-06 | timeline |
| CLUE-07 | chat（或 document） |
| CLUE-08 | timeline |
| CLUE-09 | chat |
| CLUE-10 | notification |
| CLUE-11 | document |
| CLUE-12 | chat（群聊截圖） |
| CLUE-13 | chat |
| CLUE-14 | document（結構總結卡） |

---

## 3) 顯示規則（建議）

- 線索解鎖時：顯示 `EvidenceCard`（可點開放大）
- 線索簿列表：用 `copy.clueCard.CLUE-xx.title` 做標題，點進去再看卡片內容
- **AI 來源允許**：卡片摘錄可以來自「回合 transcript」（NPC 可能由 AI 產生），但要滿足：
  - 摘錄要短（1–2 句）且可回溯到當回合輸出
  - `rationale` 必須是規則化解釋（對齊判定標籤/策略），避免 AI 自由補劇情造成矛盾


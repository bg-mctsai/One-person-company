# 計分公式（b / t / scar / rewinds）

> 目的：把結算畫面會用到的 `{b}` `{t}` `{scar}` `{rewinds}` 定義成可計算的公式（0–100）。  
> 依賴文件：`出場角色.md`（主角屬性）、`Moment Spec 表.md`（關鍵線索標記）。

---

## 0) 需要追蹤的狀態（State）

全局（整輪遊戲 run）：

- `rewinds_total`：玩家「回到 5 分鐘前」的總次數（每按一次回溯並成功付代價就 +1）
- `fails_total`：失手總次數（每次進入失手結算就 +1）
- `moments_total`：本 run 的主線幕數（精簡版主線 = 10；完整版可到 14）
- `moments_cleared`：已改寫的幕數（0–{moments_total}）
- `clues_fixed`：固定線索數（0–14；**不等於** `moments_cleared`）
  - **完整版（14 幕）**：通常每幕成功固定 1 條 → `clues_fixed == moments_cleared`
  - **精簡版主線（10 幕）**：為保留推理密度，部分幕成功會一次給 **2 條固定線索** → `clues_fixed` 仍可到 14（不可重複刷）
- `clues_key`：關鍵線索數（建議：CLUE-11~14，最多 4）
- `clues_bonus`：額外線索數（可選規則：觸發 NPC 慌張/崩潰獲得，最多計入 6）
- `player_final`：主角最終屬性快照（見 `出場角色.md`：設界線/自我價值/依賴/情緒穩定/警覺）

---

## 1) rewinds（回溯次數）

### 定義

- `{rewinds} = rewinds_total`
- 統計口徑：只要「回溯成功發生」（輪次重置、NPC 回到進場快照）就算 1 次；中途取消不算。

---

## 2) scar（創傷分，0–100）

> 你現在的設計裡，失手會直接打主角屬性（自我價值/情緒穩定等），所以 scar 可以用 **事件累積**，也能用 **屬性反推**。  
> 我這裡給你事件累積版（最直覺、最可控、最不受平衡改動影響）。

### 事件累積版（建議用這個）

\[
scar = clamp\Big(\; 12 \cdot fails\_total + 6 \cdot rewinds\_total - 2 \cdot moments\_cleared \;,\; 0,\; 100 \Big)
\]

直覺：
- 失手比回溯更痛（×12）
- 回溯也會磨損（×6）
- 成功會稍微把你拉回來（每幕 -2）

備註：
- `moments_cleared` 以本 run 的主線幕數為準（精簡版最多 10），不影響 `t` 的線索計算。

### （可選）屬性反推版（如果你不想存 scar）

\[
scar = clamp\Big(\; 100 - \frac{自我價值 + 情緒穩定}{2} \;,\; 0,\; 100 \Big)
\]

---

## 3) b（行為分，0–100）

> b = 你「有沒有變成能站著說話的人」。  
> 直接用主角期末屬性計算（不看線索）。

取值（皆 0–100，來自 `出場角色.md`）：
- `B = 設界線`
- `V = 自我價值`
- `D = 依賴`
- `S = 情緒穩定`

公式（加權平均）：

\[
b = round\Big(0.30B + 0.30V + 0.20S + 0.20(100-D)\Big)
\]

備註：
- `100-D` 表示「不靠別人批准你存在」的程度。
- b 不需要額外狀態，只要主角期末屬性。

---

## 4) t（真相分，0–100）

> t = 你「有沒有把線索串起來」。  
> 由：固定線索 + 關鍵線索 + 額外線索 + 警覺加權構成。

取值：
- `F = clues_fixed`（0–14）
- `K = clues_key`（0–4；建議 CLUE-11~14）
- `X = min(clues_bonus, 6)`（0–6）
- `A = 警覺`（0–100）

正規化：
- `F14 = F / 14`
- `K4 = K / 4`
- `X6 = X / 6`
- `A100 = A / 100`

公式：

\[
t = round\Big( 45\cdot F14 + 35\cdot K4 + 10\cdot X6 + 10\cdot A100 \Big)
\]

直覺：
- 主線走得越完整（F）越能拼圖（45%）
- 關鍵幕線索（K）權重最高（35%）
- 額外線索（X）是加分不是必需（10%）
- 警覺是你「看得出不對勁」的底盤（10%）

---

## 5) 分數區間（給毒舌系統抽句用）

建議分段：
- `good`：80–100
- `mid`：55–79
- `bad`：0–54

---

## 6) 硬規則：不自動放水（對齊你的需求）

- 不存在「連敗 N 次自動降難度 / 自動 +1 句 / 免費提示」這類 pity system。
- 玩家卡關唯一出路：**看一次訊息回到 5 分鐘前再試**（見 `復活機制.md`）。


# 對話機制設計

## 核心機制

### 對話目標
透過與NPC對話，在限定輪次內達成目標情緒狀態，改變事件走向。

### 情緒系統

#### 情緒類型

**正面情緒**（達成目標）：
- **好感**：對你產生好感，願意接納
- **欣賞**：認可你的能力或價值
- **尊重**：開始尊重你的意見和存在
- **愧疚**：意識到自己的錯誤，感到抱歉
- **認同**：認同你的觀點或行為

**負面情緒**（可能轉化為正面）：
- **憤怒**：被激怒，但可能因此正視問題
- **震驚**：被你的話語震撼，開始思考
- **崩潰**：心理防線被擊破，可能因此改變
- **慌張**：感到不安，可能因此讓步

**中性情緒**（初始狀態）：
- **冷漠**：對你漠不關心（需要改變的初始狀態）
- **困惑**：不理解你的意圖

### 對話輪次限制

> 以「合理優先」為原則：不要為了湊句數硬拉長；達標就提前結束。

- **低壓片段**：2–3 句（教學與鋪陳，建立界線基本功）
- **升壓片段**：3–5 句（開始反擊，需要把事實/請求講完整）
- **高壓片段**：4–6 句（多人壓迫/制度話術，你需要在打斷下完成表達）
- **收束片段**：3–4 句（句句落地：承擔/界線/行動）

### 對話流程

1. **場景呈現**
   - 顯示當前情境
   - 顯示NPC角色
   - 顯示NPC初始情緒狀態

2. **NPC初始對話**
   - NPC說出第一句話
   - 顯示初始情緒（通常是冷漠）

3. **你回應**
   - 自由輸入文字表達想法（主要方式）
   - 或點擊 2 個毒舌提示選項（作為策略參考）
   - 你的輸入會由 AI 解析為策略類型，影響 NPC 情緒變化

4. **情緒變化**
   - 根據你的選擇，NPC情緒發生變化
   - 顯示情緒變化動畫/效果

4.5 **（可選）打斷事件**
   - **不要在玩家打字中插話**（會干擾體驗）
   - 改為：玩家送出後 → 插入 1–2 句王明哲/林予衡/何婉柔打斷 → 再回到玩家回合
   - **不扣玩家句數**（避免玩家被陰；見 `AI對話串接.md` 的 Interrupt Event）

5. **繼續對話**
   - 根據情緒變化，NPC繼續回應
   - 你再次輸入或選擇提示選項

6. **達成目標**
   - 達到目標情緒狀態即完成「改寫」
   - 顯示成立動畫和改變結果

> 硬規則：**達標可提前結束**。不需要把句數用完才算成立。

### 對話選項設計原則

#### 1. 積極對抗型
- **特點**：直接表達需求，強硬態度
- **效果**：可能獲得尊重，也可能引起憤怒
- **適用場景**：需要打破現狀的時刻
- **範例**：「這件事不是我做的。我可以把時間線和文件攤開。」

#### 2. 溫和堅持型
- **特點**：用溫和但堅定的方式表達
- **效果**：更容易獲得認同和尊重
- **適用場景**：需要建立關係的時刻
- **範例**：「我可以補充一下我做了哪些部分，免得大家記錯。」

#### 3. 情感訴求型
- **特點**：用情感打動對方
- **效果**：可能獲得愧疚或認同
- **適用場景**：需要喚起同理心的時刻
- **範例**：「我不是在吵，我只是想被公平對待。你能不能聽我把話說完？」

#### 4. 順從消極型
- **特點**：順從對方，不表達需求
- **效果**：不會改變現狀，導致失手
- **適用場景**：無（這是錯誤選項）
- **範例**：「沒關係，我自己來就好。」

### 情緒轉化路徑

#### 常見轉化路徑

1. **冷漠 → 震驚 → 愧疚 → 尊重**
   - 適用：關係修復/喚起同理心的時刻
   - 方法：讓對方意識到自己的錯誤

2. **冷漠 → 憤怒 → 震驚 → 尊重**
   - 適用：職場挫敗類時刻
   - 方法：強硬對抗，讓對方正視問題

3. **冷漠 → 困惑 → 認同 → 欣賞**
   - 適用：需要建立關係的時刻
   - 方法：溫和堅持，逐步建立認同

4. **冷漠 → 震驚 → 崩潰 → 改變**
   - 適用：需要徹底改變的時刻
   - 方法：擊破心理防線，徹底改變

### 改寫判定

#### 達成條件
- 在限定輪次內完成
- 達到目標情緒狀態
- 改變事件走向

#### 失手條件
- 超過對話輪次限制
- NPC情緒惡化且無法挽回
- 未能達成目標情緒

### 時刻壓力分級

#### 低壓片段（2–3 句）
- 目標情緒：從冷漠 → 認同/尊重
- 轉化路徑：1–2 步即可達成
- 範例：前段「建立關係」型時刻

#### 升壓片段（3–5 句）
- 目標情緒：從冷漠 → 欣賞/愧疚
- 轉化路徑：2–3 步才能達成
- 範例：中段「開始反擊」型時刻

#### 高壓片段（4–6 句）
- 目標情緒：從冷漠 → 崩潰/徹底改變
- 轉化路徑：需要 3–4 步，可能經歷負面情緒
- 範例：後段「徹底翻盤」型時刻

> 註：上面分級用詞的「輪」實際以「玩家句數」計（見 `挑戰系統.md` 已統一為 2–6）。

### 對話範例

#### 範例1：時刻1 - 初入職場的歡迎

**輪次1**：
- **許子維**：「新人～以後有事就直接找我喔。你跟王明哲聊了什麼？（笑）」 （好感 / 試探）
- **你的輸入**：自由輸入，或選擇毒舌提示選項
  - 💡 提示 1：「謝啦。我先把交付清一下，有需要我會主動提。」（溫和堅持）
  - 💡 提示 2：「你問這個，是想幫我，還是想知道我跟王明哲說了什麼？」（積極對抗）

**輪次2**（選擇1）：
- **許子維**：「好啊，那你先忙。需要我我再補位。」（困惑 → 尊重）
- **成立**：達成目標情緒「尊重」，本刻改寫成立

#### 範例2：時刻7 - 被推卸責任

**輪次1**：
- **王明哲**：「這次延誤，你負責的部分怎麼解釋？」（冷漠）
- **你的輸入**：自由輸入，或選擇毒舌提示選項
  - 💡 提示 1：「我先把時間線講清楚：我在 XX 日完成交付，延誤發生在後續轉交。」（溫和堅持 / 帶時間點）
  - 💡 提示 2：「這不是我造成的。請你先看我這份交付紀錄。」（積極對抗 / 帶文件）

**輪次2**（輸入「這不是我造成的。請你先看我這份交付紀錄。」）：
- **王明哲**：「…給我看。」（震驚）
- **你的輸入**：自由輸入，或選擇毒舌提示選項
  - 💡 提示 1：「這裡是文件版本、提交時間、以及交付確認訊息。」（證據）
  - 💡 提示 2：「算了，可能是我記錯了。」（退縮 → 失手）

**輪次3**（輸入「這裡是文件版本、提交時間、以及交付確認訊息。」）：
- **王明哲**：「我知道了。那我會去釐清是誰在轉交環節卡住。」（震驚 → 愧疚/尊重）
- **成立**：達成目標情緒「尊重」，本刻改寫成立

### AI對話系統整合

#### 動態生成機制
- 根據你的選擇和NPC當前情緒，動態生成NPC回應
- 確保回應符合NPC性格和當前情緒狀態

#### 情緒判定系統
- 實時追蹤NPC情緒狀態
- 根據對話內容自動調整情緒值
- 達到目標情緒閾值即判定成立

#### 改寫判定系統
- 自動判定是否達成目標情緒
- 判定是否在輪次限制內完成
- 判定事件走向是否改變

### 視覺呈現

#### 情緒顯示
- **情緒圖標**：顯示NPC當前情緒（愛心=好感，火焰=憤怒等）
- **情緒條**：顯示情緒變化過程
- **表情變化**：NPC表情隨情緒變化

#### 對話呈現
- **對話框**：顯示NPC與你的對話
- **輸入框**：玩家自由輸入文字
- **毒舌提示選項**：顯示 2 個策略提示（可選，作為參考）
- **句數提示**：顯示剩餘輪次/句數

#### 成立/失手動畫
- **成立**：顯示情緒轉化動畫，NPC態度改變
- **失手**：顯示時間到或情緒惡化動畫

